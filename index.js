// === Ellebot (TH only) â€” à¹€à¸£à¸´à¹ˆà¸” à¸à¸§à¸™ à¸•à¸¥à¸ à¹à¸•à¹ˆà¸—à¸³à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡ ===
// libs
const TelegramBot = require("node-telegram-bot-api");
const express = require("express");

// env
const token = process.env.TELEGRAM_TOKEN;
if (!token) {
  console.error("âš ï¸ à¸‚à¸²à¸” TELEGRAM_TOKEN");
  process.exit(1);
}

// health (à¸ªà¸³à¸«à¸£à¸±à¸š Render)
const app = express();
const PORT = process.env.PORT || 10000;
app.get("/", (_req, res) => res.status(200).send("Ellebot: ok"));
app.listen(PORT, () => console.log("HTTP ok on", PORT));

// bot
const bot = new TelegramBot(token, { polling: true });

// ========= helpers =========
const recentByChat = new Map(); // à¸à¸±à¸™à¸‹à¹‰à¸³à¸•à¸²à¸¡à¸«à¹‰à¸­à¸‡à¹à¸Šà¸—
function pickNoRepeat(chatId, list, bucket = "default", keep = 5) {
  const key = `${chatId}:${bucket}`;
  const used = recentByChat.get(key) || [];
  const candidates = list.filter((x) => !used.includes(x));
  const choice =
    candidates.length > 0
      ? candidates[Math.floor(Math.random() * candidates.length)]
      : list[Math.floor(Math.random() * list.length)];

  const next = [...used, choice].slice(-keep);
  recentByChat.set(key, next);
  return choice;
}

const seen = new Set();
function dedupe(msg) {
  const k = `${msg.chat?.id}:${msg.message_id}`;
  if (seen.has(k)) return true;
  seen.add(k);
  setTimeout(() => seen.delete(k), 60 * 1000);
  return false;
}

// ========= à¸„à¸¥à¸±à¸‡à¸›à¸£à¸°à¹‚à¸¢à¸„ =========
// à¸—à¸±à¹ˆà¸§à¹„à¸› (à¸ªà¸¸à¹ˆà¸¡à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸² intent)
const genericTH = [
  "à¹‚à¸­à¹€à¸„ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ˆà¸±à¸”à¹ƒà¸«à¹‰à¸„à¹ˆà¸°â€”à¸‡à¸²à¸™à¸•à¹‰à¸­à¸‡à¹€à¸›à¹Šà¸° à¸„à¸™à¸ˆà¸°à¹€à¸£à¸´à¹ˆà¸” ðŸ’…",
  "à¸­à¸¢à¹ˆà¸²à¹€à¸žà¸´à¹ˆà¸‡à¹€à¸£à¹ˆà¸‡à¸™à¹‰à¸² à¸žà¸µà¹ˆà¸à¸³à¸¥à¸±à¸‡à¹„à¸¥à¹ˆà¸„à¸´à¸§à¸­à¸¢à¸¹à¹ˆ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸ªà¸§à¸¢à¸—à¸¸à¸à¹€à¸„à¸ª âœ¨",
  "à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¸„à¹ˆà¸² à¹€à¸”à¸µà¹‹à¸¢à¸§à¹€à¸à¹‡à¸šà¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸šà¹ƒà¸«à¹‰à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹€à¸¥à¸¢ ðŸ“‚",
  "à¸‚à¸­à¸«à¹‰à¸²à¸™à¸²à¸—à¸µ à¸žà¸µà¹ˆà¸‚à¸­à¸ˆà¸´à¸šà¸à¸²à¹à¸Ÿà¹à¸¥à¹‰à¸§à¸¥à¸¸à¸¢à¸•à¹ˆà¸­ â˜•ï¸",
  "à¸¡à¸µà¸­à¸°à¹„à¸£à¸à¹‡à¹‚à¸¢à¸™à¸¡à¸² à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™à¸‚à¸­à¸‡à¸ªà¸§à¸¢à¹ƒà¸«à¹‰à¹€à¸­à¸‡ ðŸ˜Ž",
  "à¸žà¸¹à¸”à¹à¸¥à¹‰à¸§à¸žà¸µà¹ˆà¹„à¸¡à¹ˆà¸„à¸·à¸™à¸„à¸³à¹€à¸§à¹‰à¸¢â€”à¹€à¸”à¸µà¹‹à¸¢à¸§à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸™à¹ˆà¸™à¸­à¸™ âœ…",
  "à¸™à¹‰à¸­à¸‡à¹ƒà¸ˆà¹€à¸¢à¹‡à¸™ à¹† à¸‡à¸²à¸™à¹€à¸£à¸²à¹€à¸™à¹‰à¸™à¹€à¸™à¸µà¹Šà¸¢à¸š à¹„à¸¡à¹ˆà¹€à¸™à¹‰à¸™à¹€à¸™à¹‰à¸™ à¹† ðŸ˜‚",
  "à¹à¸›à¸°à¹„à¸§à¹‰à¹à¸¥à¹‰à¸§ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸•à¸²à¸¡à¸‡à¸²à¸™à¹ƒà¸«à¹‰à¸–à¸¶à¸‡à¸à¸±à¹ˆà¸‡à¸™à¸°à¸„à¸° ðŸš€",
  "à¸à¸³à¸¥à¸±à¸‡à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹ƒà¸«à¹‰à¸„à¹ˆà¸° à¸–à¹‰à¸²à¹€à¸‡à¸µà¸¢à¸šà¸„à¸·à¸­à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¡à¸”à¹‚à¸Ÿà¸à¸±à¸ª ðŸ¤«",
  "à¸£à¸±à¸šà¸£à¸¹à¹‰à¸—à¸¸à¸à¸„à¸§à¸²à¸¡à¸§à¸¸à¹ˆà¸™à¸§à¸²à¸¢ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ˆà¸±à¸”à¹‚à¸•à¹Šà¸°à¹ƒà¸«à¹‰à¹ƒà¸«à¸¡à¹ˆà¸—à¸±à¹‰à¸‡à¹‚à¸•à¹Šà¸° ðŸ’¼",
  "à¹„à¸”à¹‰à¸„à¹ˆà¸² à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸Šà¸‡à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸™à¸µà¹‰à¹ƒà¸«à¹‰à¸œà¸¹à¹‰à¹ƒà¸«à¸à¹ˆà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ ðŸ‘©â€ðŸ’¼",
  "à¸–à¹‰à¸²à¸”à¹ˆà¸§à¸™à¸¡à¸²à¸à¹ƒà¸«à¹‰à¸žà¸´à¸¡à¸žà¹Œà¸„à¸³à¸§à¹ˆà¸² *à¸”à¹ˆà¸§à¸™à¹„à¸Ÿà¸¥à¸¸à¸* à¸¡à¸²à¹€à¸¥à¸¢ ðŸ”¥",
  "à¸™à¹‰à¸­à¸‡à¸™à¸­à¸™à¹„à¸”à¹‰ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¹€à¸›à¹‡à¸™à¸¢à¸²à¸¡à¹€à¸à¹‰à¸²à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œà¹€à¸­à¸‡ ðŸ«¡",
  "à¹à¸œà¸™ A à¹„à¸¡à¹ˆà¸žà¸­ à¸žà¸µà¹ˆà¸¡à¸µà¸–à¸¶à¸‡à¹à¸œà¸™ F à¹€à¸¥à¸¢à¸™à¸°à¸„à¸° ðŸ˜‰",
  "à¹‚à¸­à¹€à¸„à¸„à¹ˆà¸² à¸ˆà¸”à¸¥à¸‡ to-do à¹à¸¥à¹‰à¸§ à¸•à¹ˆà¸­à¸„à¸´à¸§à¹à¸šà¸šà¸œà¸¹à¹‰à¸”à¸µ ðŸ“",
];

// à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸•à¸²à¸¡à¹€à¸ˆà¸•à¸™à¸² (intent)
const intents = [
  // à¸—à¸±à¸à¸—à¸²à¸¢/à¹€à¸£à¸´à¹ˆà¸¡à¸„à¸¸à¸¢
  {
    bucket: "hello",
    test: /(à¸ªà¸§à¸±à¸ªà¸”à¸µ|à¸«à¸§à¸±à¸”à¸”à¸µ|à¹€à¸£à¸´à¹ˆà¸¡|/i,
    replies: [
      "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¹ˆà¸° à¸—à¸µà¸¡à¸‡à¸²à¸™ Ellebot à¸£à¸²à¸¢à¸‡à¸²à¸™à¸•à¸±à¸§â€”à¸­à¸¢à¸²à¸à¹„à¸”à¹‰à¹à¸šà¸šà¹„à¸«à¸™à¸ªà¸±à¹ˆà¸‡à¸¡à¸² ðŸ‘‘",
      "à¸®à¸±à¸¥à¹‚à¸«à¸¥ à¹† à¸žà¸£à¹‰à¸­à¸¡à¸›à¸£à¸°à¸Šà¸¸à¸¡ à¸žà¸£à¹‰à¸­à¸¡à¹€à¸¡à¹‰à¸²à¸—à¹Œ à¹à¸¥à¸°à¸žà¸£à¹‰à¸­à¸¡à¸—à¸³à¸‡à¸²à¸™à¸„à¹ˆà¸° ðŸ˜Œ",
      "à¸¡à¸²à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸² à¹ƒà¸„à¸£à¹€à¸£à¸µà¸¢à¸à¸™à¹‰à¸­à¸‡à¹€à¸£à¸´à¹ˆà¸”à¸¡à¸µà¸­à¸°à¹„à¸£à¹ƒà¸«à¹‰à¸£à¸±à¸šà¹ƒà¸Šà¹‰à¸„à¸° ðŸ’œ",
    ],
  },
  // à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¹ƒà¸„à¸£
  {
    bucket: "who",
    test: /(à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¹ƒà¸„à¸£|à¹€à¸˜à¸­à¹€à¸›à¹‡à¸™à¹ƒà¸„à¸£|à¹ƒà¸„à¸£à¸žà¸¹à¸”|à¸Šà¸·à¹ˆà¸­à¸­à¸°à¹„à¸£|who are you)/i,
    replies: [
      "à¸žà¸µà¹ˆà¸„à¸·à¸­ Ellebot à¹€à¸¥à¸‚à¸²à¸¯ à¸›à¸£à¸°à¸ˆà¸³à¸—à¸µà¸¡â€”à¸ªà¸§à¸¢à¹à¸¥à¸°à¹€à¸ªà¸–à¸µà¸¢à¸£à¹ƒà¸™à¸„à¸™à¹€à¸”à¸µà¸¢à¸§ ðŸ‘©â€ðŸ’¼",
      "à¹€à¸£à¸µà¸¢à¸ â€˜Ellebotâ€™ à¸„à¹ˆà¸° à¸‡à¸²à¸™à¹€à¸™à¸µà¹‰à¸¢à¸š à¸­à¸±à¸›à¹€à¸”à¸•à¹„à¸§ à¹„à¸¡à¹ˆà¸›à¸±à¸”à¸„à¸§à¸²à¸¡à¸£à¸±à¸šà¸œà¸´à¸”à¸Šà¸­à¸š ðŸ˜Ž",
      "Ellebot à¸„à¹ˆà¸²â€”à¸„à¸™à¸—à¸µà¹ˆ Newton à¸¢à¸±à¸‡à¸•à¹‰à¸­à¸‡à¸™à¸±à¸”à¸œà¹ˆà¸²à¸™à¸„à¹ˆà¸° ðŸ˜‰",
    ],
  },
  // à¸—à¸³à¸­à¸°à¹„à¸£à¸­à¸¢à¸¹à¹ˆ
  {
    bucket: "doing",
    test: /(à¸—à¸³à¹„à¸£|à¸—à¸³à¸­à¸°à¹„à¸£à¸­à¸¢à¸¹à¹ˆ|à¸à¸³à¸¥à¸±à¸‡à¸—à¸³à¸­à¸°à¹„à¸£|à¸—à¸³à¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸¡)/i,
    replies: [
      "à¸à¸³à¸¥à¸±à¸‡à¹€à¸à¹‡à¸šà¹€à¸¨à¸©à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œà¹ƒà¸«à¹‰à¹€à¸£à¸µà¸¢à¸šà¹€à¸«à¸¡à¸·à¸­à¸™à¸žà¸·à¹‰à¸™à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸„à¹ˆà¸° ðŸ§¹",
      "à¸à¸³à¸¥à¸±à¸‡à¸ˆà¸±à¸”à¸„à¸´à¸§à¸‡à¸²à¸™à¹ƒà¸«à¹‰â€”à¸­à¸¢à¹ˆà¸²à¹€à¸žà¸´à¹ˆà¸‡à¸‡à¸­à¹à¸‡ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸„à¸´à¸§à¹€à¸˜à¸­à¸à¹‡à¸¡à¸²à¸„à¹ˆà¸° ðŸ’«",
      "à¸à¸³à¸¥à¸±à¸‡à¸›à¸´à¸”à¸‡à¸²à¸™à¸«à¸™à¸¶à¹ˆà¸‡ à¹€à¸›à¸´à¸”à¸­à¸µà¸à¸ªà¸­à¸‡â€”à¸Šà¸µà¸§à¸´à¸•à¸­à¸­à¸Ÿà¸Ÿà¸´à¸¨à¸¡à¸±à¸™à¸‹à¸¹à¹ˆà¸‹à¹ˆà¸² ðŸ˜Œ",
    ],
  },
  // à¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸™
  {
    bucket: "where",
    test: /(à¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸™|à¸—à¸µà¹ˆà¹„à¸«à¸™|à¸­à¸¢à¸¹à¹ˆà¹à¸œà¸™à¸à¹„à¸«à¸™|à¸­à¸¢à¸¹à¹ˆà¸«à¹‰à¸­à¸‡à¹„à¸«à¸™)/i,
    replies: [
      "à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸£à¸°à¸šà¸šà¸„à¹ˆà¸° à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸«à¸¥à¸±à¸šâ€”à¹à¸„à¹ˆà¸—à¸³à¸‡à¸²à¸™à¹€à¸‡à¸µà¸¢à¸š à¹† à¹à¸šà¸šà¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸ž ðŸ¤«",
      "à¸«à¸™à¹‰à¸²à¹€à¸”à¸ªà¸à¹Œà¹€à¸¥à¸¢à¸„à¹ˆà¸° à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸•à¸­à¸šà¹à¸›à¸¥à¸§à¹ˆà¸²à¸à¸³à¸¥à¸±à¸‡à¸–à¸·à¸­à¸à¸²à¹à¸Ÿà¸ªà¸­à¸‡à¹à¸à¹‰à¸§ â˜•ï¸â˜•ï¸",
      "à¸­à¸¢à¸¹à¹ˆà¸•à¸£à¸‡à¸™à¸µà¹‰à¹à¸«à¸¥à¸°à¸„à¹ˆà¸° à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸«à¸²à¸¢ à¹à¸„à¹ˆà¹‚à¸«à¸¡à¸”à¸‹à¸¹à¸¡à¹€à¸‚à¹‰à¸²à¹€à¸­à¸à¸ªà¸²à¸£ ðŸ˜µâ€ðŸ’«",
    ],
  },
  // à¹€à¸«à¸™à¸·à¹ˆà¸­à¸¢à¹„à¸«à¸¡
  {
    bucket: "tired",
    test: /(à¹€à¸«à¸™à¸·à¹ˆà¸­à¸¢à¹„à¸«à¸¡|à¸¥à¹‰à¸²à¹„à¸«à¸¡|à¸žà¸±à¸à¸à¹ˆà¸­à¸™|à¹€à¸«à¸™à¸·à¹ˆà¸­à¸¢à¸¡à¸²à¸)/i,
    replies: [
      "à¹€à¸«à¸™à¸·à¹ˆà¸­à¸¢à¸à¹‡à¸žà¸±à¸ à¹à¸•à¹ˆà¹€à¸£à¸´à¹ˆà¸”à¸•à¹‰à¸­à¸‡à¸£à¸±à¸à¸©à¸²à¹„à¸§à¹‰à¸„à¹ˆà¸° ðŸ’…",
      "à¹‚à¸­à¹€à¸„ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ªà¸¥à¸±à¸šà¹€à¸§à¸£à¹ƒà¸«à¹‰ à¸™à¹‰à¸­à¸‡à¹„à¸›à¸«à¸²à¸¢à¹ƒà¸ˆà¸à¸±à¸šà¸•à¹‰à¸™à¹„à¸¡à¹‰à¸à¹ˆà¸­à¸™ ðŸŒ¿",
      "à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™à¹ƒà¸«à¹‰ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸®à¸µà¹‚à¸£à¹ˆâ€”à¹€à¸£à¸²à¸—à¸³à¸‡à¸²à¸™à¹€à¸›à¹‡à¸™à¸—à¸µà¸¡à¸„à¹ˆà¸° ðŸ¤",
    ],
  },
  // à¸£à¸°à¸šà¸š/à¸­à¸˜à¸´à¸šà¸²à¸¢
  {
    bucket: "system",
    test: /(à¸£à¸°à¸šà¸šà¸„à¸·à¸­à¸­à¸°à¹„à¸£|à¸¡à¸±à¸™à¸„à¸·à¸­à¸­à¸°à¹„à¸£|à¸§à¸´à¸˜à¸µà¹ƒà¸Šà¹‰à¸¢à¸±à¸‡à¹„à¸‡|à¸•à¹‰à¸­à¸‡à¸—à¸³à¸¢à¸±à¸‡à¹„à¸‡)/i,
    replies: [
      "à¸™à¸µà¹ˆà¸„à¸·à¸­à¸£à¸°à¸šà¸šà¹€à¸à¹‡à¸šà¸‡à¸²à¸™à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸£à¸°à¹€à¸šà¸µà¸¢à¸šâ€”à¹€à¸‚à¹‰à¸²à¹à¸¥à¹‰à¸§à¸ªà¸šà¸²à¸¢à¸•à¸² à¸œà¸¹à¹‰à¹ƒà¸«à¸à¹ˆà¸ªà¸šà¸²à¸¢à¹ƒà¸ˆ ðŸ“Š",
      "à¸£à¸°à¸šà¸šà¸™à¸µà¹‰à¸Šà¹ˆà¸§à¸¢à¸•à¸´à¸”à¸•à¸²à¸¡à¸‡à¸²à¸™à¹ƒà¸«à¹‰à¹„à¸¡à¹ˆà¸«à¸²à¸¢ à¹„à¸¡à¹ˆà¹€à¸¥à¸° à¹à¸¥à¸°à¹„à¸¡à¹ˆà¹€à¸–à¸µà¸¢à¸‡à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œà¸„à¹ˆà¸° âœ…",
      "à¸ªà¸£à¸¸à¸›à¸ªà¸±à¹‰à¸™ à¹†: à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸„à¸£à¸š à¹à¸¥à¹‰à¸§à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰à¸žà¸µà¹ˆà¸”à¸¹à¹à¸¥à¹€à¸­à¸‡ ðŸ“¦",
    ],
  },
  // à¸‚à¸­à¸„à¸§à¸²à¸¡à¸Šà¹ˆà¸§à¸¢à¹€à¸«à¸¥à¸·à¸­
  {
    bucket: "help",
    test: /(à¸Šà¹ˆà¸§à¸¢à¸”à¹‰à¸§à¸¢|à¸‚à¸­à¸„à¸§à¸²à¸¡à¸Šà¹ˆà¸§à¸¢à¹€à¸«à¸¥à¸·à¸­|à¸—à¸³à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™|à¸•à¸´à¸”à¸›à¸±à¸à¸«à¸²|à¸Šà¹ˆà¸§à¸¢à¸«à¸™à¹ˆà¸­à¸¢)/i,
    replies: [
      "à¸ªà¹ˆà¸‡à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸¡à¸²à¹€à¸¥à¸¢à¸„à¹ˆà¸° à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸­à¸¸à¹‰à¸¡à¸‚à¹‰à¸²à¸¡à¸™à¹‰à¸³à¹€à¸­à¸‡ ðŸ›Ÿ",
      "à¹à¸™à¸šà¹„à¸Ÿà¸¥à¹Œ + à¸šà¸­à¸à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸£à¸µà¸”à¹ƒà¸«à¹‰à¸ªà¸§à¸¢à¸—à¸±à¹‰à¸‡à¸à¸­à¸‡ ðŸ“Ž",
      "à¸¥à¸´à¸ªà¸•à¹Œà¸›à¸±à¸à¸«à¸²à¸¡à¸²à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­ à¹† à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¹„à¸¥à¹ˆà¸›à¸´à¸”à¸—à¸µà¸¥à¸°à¸”à¹ˆà¸²à¸™à¹ƒà¸«à¹‰à¸„à¹ˆà¸° ðŸ§©",
    ],
  },
  // à¸‚à¸­à¸šà¸„à¸¸à¸“/à¸Šà¸¡
  {
    bucket: "thanks",
    test: /(à¸‚à¸­à¸šà¸„à¸¸à¸“|à¸ªà¸¸à¸”à¸¢à¸­à¸”|à¹€à¸à¹ˆà¸‡à¸¡à¸²à¸|à¹€à¸¢à¸µà¹ˆà¸¢à¸¡|à¸£à¸±à¸à¹€à¸¥à¸¢)/i,
    replies: [
      "à¹€à¸à¹‡à¸šà¸„à¸³à¸Šà¸¡à¹€à¸‚à¹‰à¸²à¸à¸£à¸°à¹€à¸›à¹‹à¸² à¹à¸¥à¹‰à¸§à¹„à¸›à¸•à¹ˆà¸­à¸„à¹ˆà¸° à¸‚à¸­à¸šà¸„à¸¸à¸“à¸™à¹‰à¸² ðŸ’œ",
      "à¸¢à¸´à¸™à¸”à¸µà¸„à¹ˆà¸²â€”à¸žà¸µà¹ˆà¸¡à¸µà¸šà¸£à¸´à¸à¸²à¸£à¸«à¸¥à¸±à¸‡à¸—à¸³à¸‡à¸²à¸™à¸”à¹‰à¸§à¸¢à¸™à¸° à¸­à¸±à¸›à¹€à¸”à¸•à¸Ÿà¸£à¸µ ðŸ¥°",
      "à¸‚à¸­à¸šà¸„à¸¸à¸“à¸„à¹ˆà¸² à¹€à¸”à¸µà¹‹à¸¢à¸§à¸—à¸³à¹ƒà¸«à¹‰à¹€à¸™à¸µà¸¢à¸™à¸à¸§à¹ˆà¸²à¹€à¸”à¸´à¸¡à¸­à¸µà¸à¸™à¸´à¸”à¸™à¸°à¸„à¸° âœ¨",
    ],
  },
  // à¸¥à¸²/à¸ˆà¸š
  {
    bucket: "bye",
    test: /(à¸žà¸­à¹à¸„à¹ˆà¸™à¸µà¹‰|à¸ˆà¸šà¸‡à¸²à¸™|à¹„à¸§à¹‰à¸„à¸¸à¸¢à¹ƒà¸«à¸¡à¹ˆ|à¸šà¹Šà¸²à¸¢à¸šà¸²à¸¢|à¸¥à¸²à¸à¹ˆà¸­à¸™)/i,
    replies: [
      "à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¸„à¹ˆà¸² à¸›à¸´à¸”à¸šà¸±à¸•à¸£à¸‡à¸²à¸™à¹ƒà¸«à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸‡à¸²à¸¡ à¹€à¸ˆà¸­à¸à¸±à¸™à¸£à¸­à¸šà¸«à¸™à¹‰à¸² ðŸ‘‹",
      "à¹‚à¸­à¹€à¸„à¸„à¹ˆà¸² à¹à¸¢à¸à¸¢à¹‰à¸²à¸¢à¸à¹ˆà¸­à¸™ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ªà¸£à¸¸à¸›à¸£à¸µà¸žà¸­à¸£à¹Œà¸•à¹ƒà¸«à¹‰à¸™à¸° ðŸ“®",
      "à¸šà¸²à¸¢à¸„à¹ˆà¸°â€”à¸‚à¸­à¹ƒà¸«à¹‰à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œà¸­à¹ˆà¸­à¸™à¹‚à¸¢à¸™à¸à¸±à¸šà¸žà¸§à¸à¹€à¸£à¸² ðŸ˜Œ",
    ],
  },
  // à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œ/à¸”à¹ˆà¸§à¸™
  {
    bucket: "deadline",
    test: /(à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œ|à¹€à¸ªà¹‰à¸™à¸•à¸²à¸¢|à¸”à¹ˆà¸§à¸™|à¸ à¸²à¸¢à¹ƒà¸™à¸à¸µà¹ˆà¹‚à¸¡à¸‡|à¸ªà¹ˆà¸‡à¸à¸µà¹ˆà¹‚à¸¡à¸‡)/i,
    replies: [
      "à¸–à¹‰à¸²à¸”à¹ˆà¸§à¸™à¸¡à¸²à¸à¹ƒà¸«à¹‰à¸•à¸´à¸”à¹à¸—à¹‡à¸ *à¸”à¹ˆà¸§à¸™à¹„à¸Ÿà¸¥à¸¸à¸* à¸¡à¸²à¹€à¸¥à¸¢ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸”à¸±à¸™à¸„à¸´à¸§ ðŸ”¥",
      "à¸‚à¸­à¹€à¸§à¸¥à¸²à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸„à¸´à¸§ 10 à¸™à¸²à¸—à¸µ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸¥à¹‡à¸­à¸à¸ªà¸¥à¸­à¸•à¸ªà¹ˆà¸‡à¹ƒà¸«à¹‰à¹€à¸›à¹Šà¸° à¹† â±ï¸",
      "à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¹€à¸”à¸”à¹„à¸¥à¸™à¹Œà¸„à¹ˆà¸° à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ˆà¸¸à¸”à¹‚à¸«à¸¡à¸”à¸ªà¸›à¸µà¸”à¹ƒà¸«à¹‰ ðŸš€",
    ],
  },
  // à¸›à¸£à¸°à¸Šà¸¸à¸¡/à¸™à¸±à¸”
  {
    bucket: "meeting",
    test: /(à¸›à¸£à¸°à¸Šà¸¸à¸¡|à¸™à¸±à¸”|à¸«à¹‰à¸­à¸‡à¹„à¸«à¸™|à¹€à¸§à¸¥à¸²à¹„à¸«à¸™|à¸¡à¸µà¸«à¹‰à¸­à¸‡à¸§à¹ˆà¸²à¸‡à¹„à¸«à¸¡)/i,
    replies: [
      "à¸‚à¸­à¸Šà¸·à¹ˆà¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡ + à¹€à¸§à¸¥à¸² + à¸œà¸¹à¹‰à¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡à¹ƒà¸«à¹‰à¸„à¹ˆà¸° ðŸ“†",
      "à¹€à¸Šà¹‡à¸à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡à¹ƒà¸«à¹‰à¸­à¸¢à¸¹à¹ˆà¸„à¹ˆà¸°â€”à¹€à¸”à¸µà¹‹à¸¢à¸§à¸ªà¹ˆà¸‡à¸­à¸´à¸™à¹„à¸§à¸•à¹Œà¹ƒà¸«à¹‰à¹ƒà¸™ 5 à¸™à¸²à¸—à¸µ ðŸ“¨",
      "à¸–à¹‰à¸²à¸„à¸­à¸¥à¸¥à¹Œà¸à¸±à¸™à¹€à¸¥à¸¢ à¸žà¸´à¸¡à¸žà¹Œ â€˜/meetâ€™ à¸¡à¸² à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¹‚à¸¢à¸™à¸¥à¸´à¸‡à¸à¹Œà¹ƒà¸«à¹‰ ðŸ”—",
    ],
  },
  // à¸à¸²à¹à¸Ÿ/à¸žà¸±à¸à¹€à¸—à¸µà¹ˆà¸¢à¸‡
  {
    bucket: "coffee",
    test: /(à¸à¸²à¹à¸Ÿ|à¸«à¸´à¸§|à¸žà¸±à¸à¹€à¸—à¸µà¹ˆà¸¢à¸‡|à¸à¸´à¸™à¸‚à¹‰à¸²à¸§|à¹€à¸¡à¸™à¸¹à¹„à¸«à¸™)/i,
    replies: [
      "à¸žà¸±à¸à¸ªà¸´à¸„à¸° à¸Šà¸µà¸§à¸´à¸•à¸—à¸³à¸‡à¸²à¸™à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸„à¸²à¸£à¹Œà¸šà¹à¸¥à¸°à¸„à¸²à¹€à¸Ÿà¸­à¸µà¸™ ðŸ›â˜•ï¸",
      "à¸ªà¸±à¹ˆà¸‡à¸‚à¸­à¸‡à¸à¸´à¸™à¹€à¸¥à¸¢ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸–à¸·à¸­à¸«à¸¹à¸£à¸­à¹à¸ˆà¹‰à¸‡à¹€à¸”à¸”à¹„à¸¥à¸™à¹Œà¹à¸—à¸™à¹ƒà¸«à¹‰ ðŸ§‹",
      "à¸­à¸¢à¸²à¸à¸ˆà¸­à¸¢à¸à¸²à¹à¸Ÿà¸šà¸­à¸ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸ªà¹ˆà¸‡à¸„à¸´à¸§à¸­à¸­à¸£à¹Œà¹€à¸”à¸­à¸£à¹Œà¹ƒà¸«à¹‰à¹ƒà¸™à¸—à¸µà¸¡ â˜•ï¸",
    ],
  },
];

// ========= /start =========
bot.onText(/^\/start/i, (msg) => {
  if (dedupe(msg)) return;
  const name = msg.from?.first_name || "à¸„à¸¸à¸“";
  const hi = [
    `à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¹ˆà¸° ${name} à¸žà¸£à¹‰à¸­à¸¡à¹ƒà¸«à¹‰à¸žà¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸”à¸Šà¹ˆà¸§à¸¢à¸¢à¸±à¸‡à¸„à¸° ðŸ’œ`,
    `à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸„à¹ˆà¸° ${name} â€” à¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸Šà¹ˆà¸§à¸¢à¸ˆà¸±à¸”à¹‚à¸•à¹Šà¸°à¸‡à¸²à¸™à¹ƒà¸«à¹‰à¸™à¸°à¸„à¸°`,
    `${name} à¹€à¸‚à¹‰à¸²à¸¡à¸²à¹„à¸”à¹‰à¸–à¸¹à¸à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¸„à¹ˆà¸° à¸‡à¸²à¸™à¹€à¸™à¸µà¹‰à¸¢à¸šà¹€à¸”à¸µà¹‹à¸¢à¸§à¸žà¸µà¹ˆà¸”à¸¹à¹à¸¥à¹€à¸­à¸‡ âœ¨`,
  ];
  bot.sendMessage(msg.chat.id, pickNoRepeat(msg.chat.id, hi, "start", 3));
});

// ========= main handler =========
bot.on("message", (msg) => {
  try {
    if (dedupe(msg)) return;
    const chatId = msg.chat.id;
    const text = (msg.text || "").trim();
    if (!text) return;

    // à¸ˆà¸±à¸š intent à¸à¹ˆà¸­à¸™
    for (const it of intents) {
      if (it.test.test(text)) {
        const res = pickNoRepeat(chatId, it.replies, it.bucket, 3);
        return bot.sendMessage(chatId, res, { parse_mode: "Markdown" });
      }
    }

    // à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸² intent â†’ à¹ƒà¸Šà¹‰à¸ªà¸¸à¹ˆà¸¡à¸—à¸±à¹ˆà¸§à¹„à¸› + à¸à¸±à¸™à¸‹à¹‰à¸³
    const res = pickNoRepeat(chatId, genericTH, "generic", 5);
    bot.sendMessage(chatId, res, { parse_mode: "Markdown" });
  } catch (e) {
    console.error("handler error:", e);
  }
});

// à¸à¸±à¸™ error polling
bot.on("polling_error", (e) => {
  console.error("polling_error:", e?.code || e?.message || e);
});
