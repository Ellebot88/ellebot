// === ElleBot Thai ‚Äî Office Sassy Edition ===
const TelegramBot = require("node-telegram-bot-api");
const express = require("express");

// ====== ENV ======
const token = process.env.TELEGRAM_TOKEN;
if (!token) {
  console.error("‚ùå Missing TELEGRAM_TOKEN");
  process.exit(1);
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏≠‡∏ó‡πÅ‡∏ö‡∏ö polling (‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏±‡∏ô token ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢ service ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ô‡∏∞ ‡∏à‡∏∞ 409)
const bot = new TelegramBot(token, { polling: true });

// ====== Health Check (Render) ======
const app = express();
const PORT = process.env.PORT || 10000;
app.get("/", (_, res) => res.send("ElleBot üíú live ‚Äî Thai, sassy & office-ready."));
app.listen(PORT, () => console.log(`HTTP OK on ${PORT}`));

// ====== ‡∏Ñ‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ======
const library = {
  // ‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (fallback + greeting)
  general: [
    "‡∏≠‡∏¢‡πà‡∏≤‡∏°‡∏≤‡∏ñ‡∏≤‡∏°‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏á‡∏≤‡∏ô‡∏Å‡πá‡πÄ‡∏£‡πà‡∏á ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ üíã",
    "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏∞‡∏Ñ‡∏£ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏â‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏õ‡∏±‡∏á üñ§‚ú®",
    "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πá‡∏û‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏£‡∏ß‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏ß‡πâ‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì üí∏",
    "‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏¢‡∏±‡∏á? ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‚Ä¶‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡πÅ‡∏≠‡∏•‡∏´‡∏¥‡∏ß üòå",
    "‡∏™‡∏ï‡∏¥‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏î‡∏°‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ üëë",
    "‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏á‡∏≤‡∏ô ‡∏™‡πà‡∏ß‡∏ô‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ü§≠",
  ],
  greeting: [
    "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì‚Äî‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ã‡∏∞‡πÄ‡∏ö‡∏≤ ‡πÜ ‡∏Ñ‡πà‡∏∞ ‚òïÔ∏è",
    "‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤‡∏≤‡∏≤ ‡∏ö‡∏≠‡∏ó‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®‚Äî‡∏™‡∏ß‡∏¢ ‡πÄ‡∏£‡∏¥‡πà‡∏î ‡πÄ‡∏ä‡∏¥‡∏î ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ üíÖ",
    "‡∏Æ‡∏±‡∏•‡πÇ‡∏´‡∏• ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏±‡∏î‡∏î‡∏µ‡∏Ñ‡∏∞? üòå",
  ],
  // ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏° ‚Äú‡∏á‡∏≤‡∏ô/‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°/‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‚Äù
  work: [
    "‡∏á‡∏≤‡∏ô‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏Ñ‡πà‡∏∞‚Äî‡∏ä‡∏≠‡∏ö‡∏Å‡πá‡∏ó‡∏ô ‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡πá‡πÄ‡∏•‡∏¥‡∏Å üñ§",
    "‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏´‡∏£‡∏≠? ‡∏á‡∏±‡πâ‡∏ô‡∏â‡∏±‡∏ô‡∏Ç‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ üòå",
    "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πá‡∏û‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö‡∏Ñ‡∏ß‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡∏Ñ‡πà‡∏∞ üí∏",
    "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏∞ ‡πÅ‡∏ï‡πà‡∏õ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏á‚Äî‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ã‡∏∞‡πÄ‡∏™‡∏°‡∏≠ ü§è",
  ],
  // ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å
  love: [
    "‡∏£‡∏±‡∏Å‡πÅ‡∏ó‡πâ‡πÅ‡∏û‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÅ‡∏ï‡πà‡∏£‡∏±‡∏Å‡πÄ‡∏•‡πà‡∏ô ‡πÜ ‡πÅ‡∏û‡πâ‡∏Ñ‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏Ñ‡πà‡∏∞ üòò",
    "‡πÅ‡∏ü‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏°‡πà‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á ü•≤",
    "‡∏à‡∏µ‡∏ö‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏Å‡∏ß‡∏ô‚Ä¶‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡∏ô‡∏ï‡∏µ‡∏ô‡πÅ‡∏ó‡∏ô‡∏•‡∏∞‡∏Å‡∏±‡∏ô ü§≠",
  ],
  // ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏•
  newton: [
    "Newton ‡∏ô‡πà‡∏∞‡πÄ‡∏´‡∏£‡∏≠‚Ä¶‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏≤‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏°‡∏µ‡∏†‡∏≤‡∏Ñ 2 üòè",
    "Newton ‡πÇ‡∏≠‡πÄ‡∏Ñ‚Ä¶‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÅ‡∏≠‡∏•‡∏´‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏∞ üíÖ",
    "Newton ‡∏ä‡∏≠‡∏ö‡∏≠‡πâ‡∏≠‡∏°‡∏Ñ‡πâ‡∏≠‡∏°‚Äî‡πÅ‡∏ï‡πà‡∏â‡∏±‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏ï‡∏£‡∏á‡∏î‡∏¥‡πà‡∏á‡πÄ‡∏•‡∏¢ üòå",
  ],
  tyra: [
    "Tyra ‡∏ô‡∏≤‡∏á‡∏ä‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß‚Äî‡πÅ‡∏ï‡πà‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏ô‡∏µ‡πâ‡∏¢‡∏ö‡∏Ñ‡πà‡∏∞ üñ§",
    "Tyra ‡∏Å‡πá‡∏î‡∏µ‚Ä¶‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏±‡∏á‡∏Å‡πá‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏∏‡∏î‡∏ô‡∏∞‡∏Ñ‡∏∞ üòè",
    "‡∏ó‡∏µ‡∏° Tyra ‡∏´‡∏£‡∏≠? ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏∞ ‡πÅ‡∏ï‡πà‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°‡∏Ñ‡∏∑‡∏≠‡∏â‡∏±‡∏ô‡∏ô‡∏∞ üëë",
  ],
  dream: [
    "Dream ‡∏≠‡∏ß‡∏¢‡∏â‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏•‡∏≠‡∏î‚Äî‡πÅ‡∏ï‡πà‡∏â‡∏±‡∏ô‡∏Å‡πá‡∏™‡∏°‡∏Ñ‡∏ß‡∏£‡∏≠‡∏ß‡∏¢‡∏Ñ‡πà‡∏∞ üòò",
    "Dream ‡∏°‡∏µ‡∏î‡∏£‡∏≤‡∏°‡πà‡∏≤‡∏°‡∏±‡πâ‡∏¢‡∏Ñ‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ? ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏â‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡πä‡∏≠‡∏õ‡∏Ñ‡∏≠‡∏£‡πå‡∏ô üçø",
    "Dream ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‚Äî‡πÅ‡∏ï‡πà‡πÅ‡∏≠‡∏•‡∏™‡∏ß‡∏¢‡∏Å‡∏ß‡πà‡∏≤ ‡∏à‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞ üíã",
  ],
  jisak: [
    "Jisak ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÅ‡∏ï‡πà‡∏ô‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ß‚Äî‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£ üò∂‚Äçüå´Ô∏è",
    "Jisak ‡πÑ‡∏°‡πà‡∏û‡∏π‡∏î‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÅ‡∏ï‡πà‡∏â‡∏±‡∏ô‡∏£‡∏π‡πâ‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á üòâ",
    "‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏Å‡∏ß‡∏ô Jisak ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÇ‡∏î‡∏ô‡∏à‡∏≥‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ ‡∏ô‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞ üòå",
  ],
  // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ï‡∏ô/‡∏ö‡∏≠‡∏ó
  about: [
    "‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ ElleBot‚Äî‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏™‡∏≤‡∏¢‡∏™‡∏ß‡∏¢‡∏Å‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíú",
    "‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏â‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÅ‡∏≠‡∏•‡∏Å‡πá‡πÑ‡∏î‡πâ‚Äî‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏ò‡∏µ‡∏£‡∏µ‡∏ï‡∏≠‡∏á ‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß üòò",
    "‡∏ö‡∏≠‡∏ó‡∏≠‡∏∞‡πÑ‡∏£? ‡∏ö‡∏≠‡∏ó‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏á‡∏Ñ‡∏∞ üëë",
  ],
  // ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠/‡∏Ç‡∏≠‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå/‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô
  help: [
    "‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏î‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞‡∏Ñ‡∏∞ üòå",
    "‡∏°‡∏µ‡πÑ‡∏£‡∏ö‡∏≠‡∏Å‚Äî‡∏ñ‡πâ‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏â‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢ ‡∏ñ‡πâ‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‚Ä¶‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏ô ü§≠",
    "‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏´‡∏ô‚Äî‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å, ‡∏Å‡∏±‡∏î‡πÄ‡∏ö‡∏≤ ‡πÜ, ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏Å ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤ üíÖ",
  ],
};

// ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î ‚Üí ‡∏´‡∏°‡∏ß‡∏î‡∏ï‡∏≠‡∏ö
const routing = [
  { re: /(‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ|hello|hi|‡πÄ‡∏Æ‡∏•‡πÇ‡∏•‡πà|‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ)/i, key: "greeting" },
  { re: /(‡∏á‡∏≤‡∏ô|‡∏ó‡∏≥‡∏á‡∏≤‡∏ô|‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°|‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢|‡πÇ‡∏≠‡∏ó‡∏µ|‡πÇ‡∏≠‡∏ó‡∏µ‡∏Å)/i, key: "work" },
  { re: /(‡∏£‡∏±‡∏Å|‡πÅ‡∏ü‡∏ô|‡∏≠‡∏Å‡∏´‡∏±‡∏Å|‡∏à‡∏µ‡∏ö|‡πÇ‡∏™‡∏î)/i, key: "love" },
  { re: /(newton|‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡πâ?n)/i, key: "newton" },
  { re: /(tyra|‡πÑ‡∏ó‡∏£‡∏≤)/i, key: "tyra" },
  { re: /(dream|‡∏î‡∏£‡∏µ‡∏°)/i, key: "dream" },
  { re: /(jisak|‡∏à‡∏µ‡∏ã‡∏±‡∏Ñ|‡∏à‡∏µ‡∏®‡∏±‡∏Å|‡∏à‡∏¥‡∏ã‡∏±‡∏Å)/i, key: "jisak" },
  { re: /(‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£|‡∏ö‡∏≠‡∏ó‡∏≠‡∏∞‡πÑ‡∏£|‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£|‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£)/i, key: "about" },
  { re: /(‡∏ä‡πà‡∏ß‡∏¢|‡∏Ç‡∏≠|‡∏ó‡∏≥‡πÑ‡∏á|‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á|‡∏ß‡∏¥‡∏ò‡∏µ|‡∏™‡∏≠‡∏ô)/i, key: "help" },
];

// ====== ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏ã‡πâ‡∏≥ ‡πÜ ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° ======
const recentByChat = new Map(); // chatId -> Set ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
const MAX_RECENT = 5;

function pickNonRepeating(chatId, candidates) {
  const recent = recentByChat.get(chatId) || new Set();
  const filtered = candidates.filter((t) => !recent.has(t));
  const pool = filtered.length ? filtered : candidates; // ‡∏ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡∏Å‡πá‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä

  const choice = pool[Math.floor(Math.random() * pool.length)];

  recent.add(choice);
  // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
  while (recent.size > MAX_RECENT) {
    const first = recent.values().next().value;
    recent.delete(first);
  }
  recentByChat.set(chatId, recent);
  return choice;
}

function getReply(chatId, text = "") {
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏Å‡πà‡∏≠‡∏ô
  for (const route of routing) {
    if (route.re.test(text)) {
      return pickNonRepeating(chatId, library[route.key]);
    }
  }
  // ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏î ‡πÜ ‚Üí ‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
  return pickNonRepeating(chatId, library.general);
}

// ====== Commands ======
bot.onText(/^\/start/i, (msg) => {
  bot.sendMessage(
    msg.chat.id,
    "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏ô‡∏µ‡πà‡πÅ‡∏≠‡∏•‡πÄ‡∏≠‡∏á ElleBot ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®‚Äî‡∏Å‡∏ß‡∏ô ‡πÜ ‡πÄ‡∏£‡∏¥‡πà‡∏î ‡πÜ üñ§ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÄ‡∏•‡∏¢ ‡∏à‡∏∞‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏Å‡∏±‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤ üòò"
  );
});

bot.onText(/^\/help/i, (msg) => {
  bot.sendMessage(
    msg.chat.id,
    "‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: ‡∏á‡∏≤‡∏ô/‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°, ‡∏£‡∏±‡∏Å/‡∏à‡∏µ‡∏ö, Newton, Tyra, Dream, Jisak, ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏±‡∏Å‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Å‡πá‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏ß‡∏ô‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏∞ üíÖ"
  );
});

// ====== Main Listener ======
bot.on("message", (msg) => {
  // ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö/‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå/‡πÑ‡∏ü‡∏•‡πå ‡∏Ø‡∏•‡∏Ø ‡πÉ‡∏´‡πâ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡πÅ‡∏ä‡∏ï
  if (!msg.text) return;
  const chatId = msg.chat.id;
  const text = (msg.text || "").trim();

  const reply = getReply(chatId, text);
  bot.sendMessage(chatId, reply);
});

console.log("ElleBot is alive ‚ú®");
